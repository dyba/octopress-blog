<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Daniel Dyba]]></title>
  <link href="http://danieldyba.com/atom.xml" rel="self"/>
  <link href="http://danieldyba.com/"/>
  <updated>2011-11-25T14:48:37-08:00</updated>
  <id>http://danieldyba.com/</id>
  <author>
    <name><![CDATA[Daniel Dyba]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Code Kata 4: A TDD Attempt Toward Readable Code]]></title>
    <link href="http://danieldyba.com/blog/2011/11/25/code-kata-4-a-tdd-attempt-toward-readable-code/"/>
    <updated>2011-11-25T13:02:00-08:00</updated>
    <id>http://danieldyba.com/blog/2011/11/25/code-kata-4-a-tdd-attempt-toward-readable-code</id>
    <content type="html"><![CDATA[<h2>Code Kata #4 - Data Munging Part One</h2>

<h3>Overview</h3>

<p>The fourth Code Kata in Dave Thomas&#8217; Code Kata blog asks you to do the following:</p>

<blockquote><p>write a program to output the day number (column one) with the smallest temperature spread (the maximum temperature is the second column, the minimum the third column).</p></blockquote>


<p>He provides a weather.dat file for you to download and which you will parse through in order to obtain the solution. In this post, I will only cover the first part of the code kata. I completed the first part of the kata over the course of 3 days working up to 4 hours on one day and thinking about the problem when not in front of the computer screen. Let&#8217;s take a look at a solution I developed.</p>

<h3>The Completed Code</h3>

<figure class='code'><figcaption><span>WeatherReader program at /lib/weather_reader.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">WeatherReader</span>
</span><span class='line'>  <span class="kp">attr_reader</span> <span class="ss">:data</span><span class="p">,</span> <span class="ss">:spread</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</span><span class='line'>    <span class="vi">@data</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">readlines</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span><span class="o">.</span><span class="n">reject</span><span class="p">(</span><span class="o">&amp;</span><span class="n">no_data</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">date_of_smallest_spread</span>
</span><span class='line'>    <span class="vi">@data</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="o">&amp;</span><span class="n">spread</span><span class="p">)</span><span class="o">.</span><span class="n">find_index</span><span class="p">(</span><span class="n">smallest_spread</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">smallest_spread</span>
</span><span class='line'>    <span class="vi">@data</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="o">&amp;</span><span class="n">spread</span><span class="p">)</span><span class="o">.</span><span class="n">min</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">spread</span>
</span><span class='line'>    <span class="vi">@spread</span> <span class="o">||=</span> <span class="o">-&gt;</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="n">temperature</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="ss">:max</span><span class="p">)</span> <span class="o">-</span> <span class="n">temperature</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="ss">:min</span><span class="p">))</span><span class="o">.</span><span class="n">abs</span> <span class="p">}</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="kp">private</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">temperature</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">kind</span><span class="p">)</span>
</span><span class='line'>      <span class="n">line</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">regex</span><span class="p">)</span><span class="o">[</span><span class="n">kind</span><span class="o">].</span><span class="n">to_i</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">no_data</span>
</span><span class='line'>      <span class="o">-&gt;</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="p">{</span> <span class="n">line</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">regex</span><span class="p">)</span><span class="o">.</span><span class="n">nil?</span> <span class="p">}</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">regex</span>
</span><span class='line'>      <span class="sr">%r{</span>
</span><span class='line'><span class="sr">        (?&lt;day&gt; \d+){0}</span>
</span><span class='line'><span class="sr">        (?&lt;max&gt; \d+){0}</span>
</span><span class='line'><span class="sr">        (?&lt;min&gt; \d+){0}</span>
</span><span class='line'>
</span><span class='line'><span class="sr">        \g&lt;day&gt;\s+\g&lt;max&gt;\s+\g&lt;min&gt;</span>
</span><span class='line'><span class="sr">      }x</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>RSpec Examples /spec/weather_reader_spec.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;rspec&#39;</span>
</span><span class='line'><span class="nb">require</span> <span class="s1">&#39;spec_helper&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="n">describe</span> <span class="no">WeatherReader</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">describe</span> <span class="s2">&quot;Utility methods&quot;</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">let</span><span class="p">(</span><span class="ss">:weather_reader</span><span class="p">)</span> <span class="p">{</span> <span class="no">WeatherReader</span><span class="o">.</span><span class="n">new</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">before</span><span class="p">(</span><span class="ss">:each</span><span class="p">)</span> <span class="k">do</span>
</span><span class='line'>      <span class="vi">@data</span> <span class="o">=</span> <span class="n">weather_reader</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s2">&quot;weather.dat&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">it</span> <span class="s2">&quot;filters lines that don&#39;t contain weather data&quot;</span> <span class="k">do</span>
</span><span class='line'>      <span class="vi">@data</span><span class="o">.</span><span class="n">should_not</span> <span class="kp">include</span><span class="p">(</span><span class="s2">&quot; MMU June 2002</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">context</span> <span class="s2">&quot;given a line containing weather data for a day&quot;</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">let</span><span class="p">(</span><span class="ss">:line</span><span class="p">)</span> <span class="p">{</span> <span class="s2">&quot;   1  88    59    74          53.8       0.00 F       280  9.6 270  17  1.6  93 23 1004.5&quot;</span> <span class="p">}</span>
</span><span class='line'>      <span class="n">it</span> <span class="s2">&quot;returns the difference between the maximum temperature and minimum temperature&quot;</span> <span class="k">do</span>
</span><span class='line'>        <span class="n">weather_reader</span><span class="o">.</span><span class="n">spread</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">line</span><span class="p">)</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="mi">29</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">context</span> <span class="s2">&quot;given lines containing weather data for several days&quot;</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">it</span> <span class="s2">&quot;returns the smallest temperature spread&quot;</span> <span class="k">do</span>
</span><span class='line'>        <span class="n">weather_reader</span><span class="o">.</span><span class="n">smallest_spread</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="mi">2</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">it</span> <span class="s2">&quot;returns the date that had the smallest temperature spread&quot;</span> <span class="k">do</span>
</span><span class='line'>        <span class="n">weather_reader</span><span class="o">.</span><span class="n">date_of_smallest_spread</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="mi">14</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>Contents of the weather.dat file</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">(</span>Unofficial, Preliminary Data<span class="o">)</span>. Source: &lt;a
</span><span class='line'><span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://www.erh.noaa.gov/er/box/dailystns.html&quot;</span>&gt;www.erh.noaa.gov/er/box/dailystns.html&lt;/a&gt;
</span><span class='line'>
</span><span class='line'>&lt;pre&gt;
</span><span class='line'> MMU June 2002
</span><span class='line'>
</span><span class='line'>  Dy MxT   MnT   AvT   HDDay  AvDP 1HrP TPcpn WxType PDir AvSp Dir MxS SkyC MxR MnR AvSLP
</span><span class='line'>
</span><span class='line'>   1  88    59    74          53.8       0.00 F       280  9.6 270  17  1.6  93 23 1004.5
</span><span class='line'>   2  79    63    71          46.5       0.00         330  8.7 340  23  3.3  70 28 1004.5
</span><span class='line'>   3  77    55    66          39.6       0.00         350  5.0 350   9  2.8  59 24 1016.8
</span><span class='line'>   4  77    59    68          51.1       0.00         110  9.1 130  12  8.6  62 40 1021.1
</span><span class='line'>   5  90    66    78          68.3       0.00 TFH     220  8.3 260  12  6.9  84 55 1014.4
</span><span class='line'>   6  81    61    71          63.7       0.00 RFH     030  6.2 030  13  9.7  93 60 1012.7
</span><span class='line'>   7  73    57    65          53.0       0.00 RF      050  9.5 050  17  5.3  90 48 1021.8
</span><span class='line'>   8  75    54    65          50.0       0.00 FH      160  4.2 150  10  2.6  93 41 1026.3
</span><span class='line'>   9  86    32*   59       6  61.5       0.00         240  7.6 220  12  6.0  78 46 1018.6
</span><span class='line'>  10  84    64    74          57.5       0.00 F       210  6.6 050   9  3.4  84 40 1019.0
</span><span class='line'>  11  91    59    75          66.3       0.00 H       250  7.1 230  12  2.5  93 45 1012.6
</span><span class='line'>  12  88    73    81          68.7       0.00 RTH     250  8.1 270  21  7.9  94 51 1007.0
</span><span class='line'>  13  70    59    65          55.0       0.00 H       150  3.0 150   8 10.0  83 59 1012.6
</span><span class='line'>  14  61    59    60       5  55.9       0.00 RF      060  6.7 080   9 10.0  93 87 1008.6
</span><span class='line'>  15  64    55    60       5  54.9       0.00 F       040  4.3 200   7  9.6  96 70 1006.1
</span><span class='line'>  16  79    59    69          56.7       0.00 F       250  7.6 240  21  7.8  87 44 1007.0
</span><span class='line'>  17  81    57    69          51.7       0.00 T       260  9.1 270  29* 5.2  90 34 1012.5
</span><span class='line'>  18  82    52    67          52.6       0.00         230  4.0 190  12  5.0  93 34 1021.3
</span><span class='line'>  19  81    61    71          58.9       0.00 H       250  5.2 230  12  5.3  87 44 1028.5
</span><span class='line'>  20  84    57    71          58.9       0.00 FH      150  6.3 160  13  3.6  90 43 1032.5
</span><span class='line'>  21  86    59    73          57.7       0.00 F       240  6.1 250  12  1.0  87 35 1030.7
</span><span class='line'>  22  90    64    77          61.1       0.00 H       250  6.4 230   9  0.2  78 38 1026.4
</span><span class='line'>  23  90    68    79          63.1       0.00 H       240  8.3 230  12  0.2  68 42 1021.3
</span><span class='line'>  24  90    77    84          67.5       0.00 H       350  8.5 010  14  6.9  74 48 1018.2
</span><span class='line'>  25  90    72    81          61.3       0.00         190  4.9 230   9  5.6  81 29 1019.6
</span><span class='line'>  26  97*   64    81          70.4       0.00 H       050  5.1 200  12  4.0 107 45 1014.9
</span><span class='line'>  27  91    72    82          69.7       0.00 RTH     250 12.1 230  17  7.1  90 47 1009.0
</span><span class='line'>  28  84    68    76          65.6       0.00 RTFH    280  7.6 340  16  7.0 100 51 1011.0
</span><span class='line'>  29  88    66    77          59.7       0.00         040  5.4 020   9  5.3  84 33 1020.6
</span><span class='line'>  30  90    45    68          63.6       0.00 H       240  6.0 220  17  4.8 200 41 1022.7
</span><span class='line'>  mo  82.9  60.5  71.7    16  58.8       0.00              6.9          5.3
</span><span class='line'>&lt;/pre&gt;
</span></code></pre></td></tr></table></div></figure>


<h2>TDD is Software Improv</h2>

<p>It is unfortunate that I didn&#8217;t capture the dynamic interplay between writing/rewriting the tests and writing/rewriting the code in this example. I think I originally heard it from David Chelimsky at SCNA 2011 who said that Test Driven Development is Software Improv. TDD is a sweeping movement involving writing your tests, writing code to pass your tests, refactoring your code, refactoring your tests, critiquing your code to determine how you should write your next test, and critiquing your tests to inform the design of your code. TDD truly is an art form.</p>

<p>Even as I write this post, I understand how difficult it is to capture the TDD process in writing. Have you ever seen Live Improv as a series of photos? For one thing, you won&#8217;t catch the humor in the dialogue. You might laugh at the pictures, but you won&#8217;t get the jokes unless you had understood the context in which they were delivered; that&#8217;s where the dialogue is important. But listening to the dialogue alone isn&#8217;t enough. You wouldn&#8217;t be able to capture the subtle nuances in the gestures of the performers. The photos wouldn&#8217;t capture that because they are minutes, even seconds apart. Now what happens if you see Live Improv as an audience member? You finally get it. In the same way, TDD cannot be expressed as a static blog post. I do not do it justice by simply talking about it; however, I will do my best to inform you what happens in the process of doing TDD.</p>

<h2>Debrief</h2>

<h3>How&#8217;d you get there?</h3>

<p>At the beginning, I started writing very trivial test cases that would check for the return type of the <code>read</code> method. It would check to make sure that the return values were not nil. Of course, you don&#8217;t see these test cases in the final product. That&#8217;s because those tests acted like scaffolding that I temporarily used to get me started. After I build the right structure in my program, I wrote other tests that rendered that scaffolding test code obsolete.</p>

<p>TDD is an incremental process. You should only be writing the minimal amount of code to make your tests pass. I think this is where I didn&#8217;t do as great a job executing TDD. Once I understood the pattern of the code I needed to write, I went ahead and wrote that as production code. In the real world, the patterns won&#8217;t be as obvious and it will take having to write code for every case until you see an overarching picture of the kind of code that would cover the general case.</p>

<p>The example I will cite here is when I test a single line of data to determine if I get the right value for the spread of the maximum and minimum temperature. The next thing I do is write the code that does that for every line of code. Probably the way I should have gone about that was to write a regular expression that was hardcoded to that particular string. Then I should have thrown in another case where there is an asterisk next to the maximum or minimum temperature as is true for day 9 or day 26 in the weather.dat file. When you work on a larger project, it may not be obvious how you can generalize the production code you need to write. Thus, it is a good habit to build your program incrementally when you do TDD.</p>

<h3>Programming With Lambdas</h3>

<p>Recently, I have been making more of an effort to introduce lambdas in my code. Lambdas and Procs were one of the most nebulous ideas for me when I first started programming in Ruby. Only recently did I start playing with passing lambdas as arguments to methods. Originally, the <code>no_data</code> method wasn&#8217;t in my code. It came about during the refactoring phase when I wanted to make the read method more concise (and curiously also wanted to see if I could extract the code block into something more meaningful). The code had read like so:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</span><span class='line'>  <span class="no">File</span><span class="o">.</span><span class="n">readlines</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">line</span><span class="o">|</span>
</span><span class='line'>    <span class="n">line</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">regex</span><span class="p">)</span><span class="o">.</span><span class="n">nil?</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now, there&#8217;s nothing wrong with that. However, if I were another programmer trying to read this code, I would be asking myself, &#8220;What are you matching against?&#8221; So I decided to write this instead:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</span><span class='line'>  <span class="no">File</span><span class="o">.</span><span class="n">readlines</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span><span class="o">.</span><span class="n">reject</span><span class="p">(</span><span class="o">&amp;</span><span class="n">no_data</span><span class="p">)</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>To me that reads more clearly than the first example. It may be a little difficult for newer programmers to understand what the syntax is doing. But it is clear that I am rejecting data from the lines of the file I read. Here is the code for the <code>no_data</code> method.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">no_data</span>
</span><span class='line'>  <span class="o">-&gt;</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="p">{</span> <span class="n">line</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">regex</span><span class="p">)</span><span class="o">.</span><span class="n">nil?</span> <span class="p">}</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>The name of the method communicates its function. It defines what data is not; however, I probably could have written a different name for <code>regex</code>. Looking at it right now it doesn&#8217;t communicate its intent. Perhaps, I should have written something like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">no_data</span>
</span><span class='line'>  <span class="o">-&gt;</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="p">{</span> <span class="n">line</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">weather_data</span><span class="p">)</span><span class="o">.</span><span class="n">nil?</span> <span class="p">}</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>That would have been more helpful to someone who is trying to find out how the <code>no_data</code> method works.</p>

<h3>Being Expressive with Regular Expressions</h3>

<p>If that same programmer wanted to see what <code>regex</code> would look like, they would see this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">regex</span>
</span><span class='line'>  <span class="sr">%r{</span>
</span><span class='line'><span class="sr">    (?&lt;day&gt; \d+){0}</span>
</span><span class='line'><span class="sr">    (?&lt;max&gt; \d+){0}</span>
</span><span class='line'><span class="sr">    (?&lt;min&gt; \d+){0}</span>
</span><span class='line'>
</span><span class='line'><span class="sr">    \g&lt;day&gt;\s+\g&lt;max&gt;\s+\g&lt;min&gt;</span>
</span><span class='line'><span class="sr">  }x</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Originally, I had written down this expression:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">regex</span><span class="sr"></span>
</span><span class='line'><span class="sr">  /(\d+)\s+(\d+)\s+(\d+)/</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>What is that expression supposed to be doing? It is capturing three groups of numbers that are separated by spaces. But those numbers don&#8217;t have any meaning at all! That&#8217;s when I decided to use the &#8216;x&#8217; option to allow spaces in my regular expression. I went ahead and added named subroutines in order to layer the regular expression with meaning. Notice that I named the groups as <code>&lt;day&gt;</code>,<code>&lt;max&gt;</code>,<code>&lt;min&gt;</code>&#8212;all names that are relevant to the problem at hand. Unfortunately, those names alone don&#8217;t provide much meaning to the problem, I probably should have been a bit more descriptive with the names: &#8220;Maximum of what?&#8221;, &#8220;Minimum of what?&#8221; &#8220;Are we talking about heights? weights? distances?&#8221; A better implementation would have been:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">weather_data</span>
</span><span class='line'>  <span class="sr">%r{</span>
</span><span class='line'><span class="sr">    (?&lt;day&gt;             \d+){0}</span>
</span><span class='line'><span class="sr">    (?&lt;max_temperature&gt; \d+){0}</span>
</span><span class='line'><span class="sr">    (?&lt;min_temperature&gt; \d+){0}</span>
</span><span class='line'>
</span><span class='line'><span class="sr">    \g&lt;day&gt;\s+\g&lt;max_temperature&gt;\s+\g&lt;min_temperature&gt;</span>
</span><span class='line'><span class="sr">  }x</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>The reason why I didn&#8217;t add the names <code>max_temperature</code>, and <code>min_temperature</code>, was because of the way I implemented the <code>temperature</code> method in my program.</p>

<h3>Something Smells</h3>

<p>Take a look at the following code:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="k">def</span> <span class="nf">spread</span>
</span><span class='line'>    <span class="vi">@spread</span> <span class="o">||=</span> <span class="o">-&gt;</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="n">temperature</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="ss">:max</span><span class="p">)</span> <span class="o">-</span> <span class="n">temperature</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="ss">:min</span><span class="p">))</span><span class="o">.</span><span class="n">abs</span> <span class="p">}</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="kp">private</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">temperature</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">kind</span><span class="p">)</span>
</span><span class='line'>      <span class="n">line</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">regex</span><span class="p">)</span><span class="o">[</span><span class="n">kind</span><span class="o">].</span><span class="n">to_i</span>
</span><span class='line'>    <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Had I changed the names in my regular expressions, I would have had to change the above code to this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="k">def</span> <span class="nf">spread</span>
</span><span class='line'>    <span class="vi">@spread</span> <span class="o">||=</span> <span class="o">-&gt;</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="n">temperature</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="ss">:max_temperature</span><span class="p">)</span> <span class="o">-</span> <span class="n">temperature</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="ss">:min_temperature</span><span class="p">))</span><span class="o">.</span><span class="n">abs</span> <span class="p">}</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="kp">private</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">temperature</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">kind</span><span class="p">)</span>
</span><span class='line'>      <span class="n">line</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">regex</span><span class="p">)</span><span class="o">[</span><span class="n">kind</span><span class="o">].</span><span class="n">to_i</span>
</span><span class='line'>    <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Why is temperature mentioned twice in a method call? It is adding too much noise. I should have just gotten rid of the <code>temperature</code> method and attempted a better implementation like so:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="k">def</span> <span class="nf">spread</span>
</span><span class='line'>    <span class="vi">@spread</span> <span class="o">||=</span> <span class="o">-&gt;</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">weather_data</span><span class="p">)</span><span class="o">[</span><span class="ss">:max_temperature</span><span class="o">].</span><span class="n">to_i</span> <span class="o">-</span> <span class="n">line</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">weather_data</span><span class="p">)</span><span class="o">[</span><span class="ss">:min_temperature</span><span class="o">].</span><span class="n">to_i</span><span class="p">)</span><span class="o">.</span><span class="n">abs</span> <span class="p">}</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="kp">private</span>
</span><span class='line'><span class="cm">=begin </span>
</span><span class='line'><span class="cm">Smells bad</span>
</span><span class='line'><span class="cm">    def temperature(line, kind)</span>
</span><span class='line'><span class="cm">      line.match(regex)[kind].to_i</span>
</span><span class='line'><span class="cm">    end</span>
</span><span class='line'><span class="cm">=end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Even the above implementation is too long to read, but it communicates its intent better than the method I had written.</p>

<h2>Take Aways</h2>

<p>When doing TDD, you always need to keep in mind the other programmer who will be reading your code. It is not enough to make the program work; it needs to be readable and easy to understand for the rest of your team.</p>

<p>There are other things I didn&#8217;t get a chance to cover in this post that would have made it too long: one of those things included the implementation of finding the smallest spread and the date for that spread. I&#8217;d like to see your implementation of this code kata. Perhaps there is some other way of implementing this that had not occurred to me. I welcome your insight. I invite you to provide any feedback in the comments below.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[String Calculator Kata Without If, Else, Switch, or Case]]></title>
    <link href="http://danieldyba.com/blog/2011/11/23/string-calculator-kata-without-if/"/>
    <updated>2011-11-23T14:06:00-08:00</updated>
    <id>http://danieldyba.com/blog/2011/11/23/string-calculator-kata-without-if</id>
    <content type="html"><![CDATA[<p>The goal of this kata is to create a calculator that can add the numbers found in a string. I found this kata on <a href="http://osherove.com/tdd-kata-1/">Roy Osherove&#8217;s website</a>. Here are the instructions for doing this kata:</p>

<h2>String Calculator Kata Overview</h2>

<h2>The Rules</h2>

<ol>
<li>Create a simple String calculator with a method <strong>int Add(string numbers)</strong>

<ol>
<li>The method can take 0, 1, or 2 numbers, and will return their sum (for an empty string it will return 0) for example &#8220;&#8221; or &#8220;1&#8221;, or &#8220;1,2&#8221;</li>
<li>Start with the simplest test case of an empty string and move to 1 and two numbers</li>
<li>Remember to solve things as simply as possible so that you force yourself to write tests you did not think about</li>
<li>Remember to refactor after each passing test</li>
</ol>
</li>
<li>Allow the Add method to handle an unknown amount of numbers</li>
<li>Allow the Add method to handle new lines between numbers (instead of commas).

<ol>
<li>The following input is OK: &#8220;1\n2,3&#8221; (will equal 6)</li>
<li>The following input is NOT OK: &#8220;1,\n&#8221; (not need to price it - just clarifying)</li>
</ol>
</li>
<li>Support different delimiters

<ol>
<li>To change a delimiter, the beginning of the string will contain a separate  line that looks like this: &#8220;//[delimiter]\n[numbers…]&#8221; for example &#8220;//;\n1;2&#8221; should return three where the default delimiter is &#8216;;&#8217;.</li>
</ol>
</li>
</ol>


<p>There are more instructions to this kata but that was as far as I was able to get without going too far over the time limit. I imposed a 30 minute time limit to complete this kata.</p>

<h3>Constraints Inspire Creative-Thinking</h3>

<p>I want to make a very important observation here. I could have solved this kata with programming techniques with which I am familiar; however, familiarity does not breed creativity. If you want to take your creativity to the next level, you need to put constraints. Constraints are your friends. They are the ones that prod you to think about novel ways of doing things. In this kata, I added the constraint of avoiding these keywords:</p>

<ul>
<li>  <code>if</code></li>
<li>  <code>else</code></li>
<li>  <code>switch</code></li>
<li>  <code>case</code></li>
</ul>


<p>It&#8217;s amazing what you&#8217;ll discover when you impose these constraints. I began to write my solution in a Lispy sort of fashion as you&#8217;ll soon see.</p>

<h2>The Completed Kata</h2>

<figure class='code'><figcaption><span>The Completed String Calculator Kata</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;rspec&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">StringCalculator</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
</span><span class='line'>    <span class="n">string</span><span class="o">.</span><span class="n">empty?</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="k">return</span> <span class="mi">0</span><span class="p">)</span>
</span><span class='line'>    <span class="n">string</span><span class="o">.</span><span class="n">end_with?</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="k">return</span> <span class="kp">nil</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">string</span><span class="o">.</span><span class="n">start_with?</span><span class="p">(</span><span class="s2">&quot;//&quot;</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
</span><span class='line'>      <span class="p">(</span><span class="vi">@delimiter</span> <span class="o">||=</span> <span class="n">string</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">&#39;^//(.)&#39;</span><span class="p">)</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
</span><span class='line'>        <span class="n">string</span><span class="o">.</span><span class="n">sub!</span><span class="p">(</span><span class="sr">/^\/\/(.)/</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">string</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
</span><span class='line'>      <span class="n">string</span><span class="o">.</span><span class="n">gsub!</span><span class="p">(</span><span class="sr">/\n/</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="vi">@delimiter</span> <span class="o">&amp;&amp;</span>
</span><span class='line'>      <span class="p">(</span><span class="k">return</span> <span class="n">string</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">#{</span><span class="vi">@delimiter</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:to_i</span><span class="p">)</span><span class="o">.</span><span class="n">inject</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:+</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">string</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sr">/[,\s]/</span><span class="p">)</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:to_i</span><span class="p">)</span><span class="o">.</span><span class="n">inject</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:+</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">describe</span> <span class="no">StringCalculator</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">let</span><span class="p">(</span><span class="ss">:calc</span><span class="p">)</span> <span class="p">{</span> <span class="no">StringCalculator</span><span class="o">.</span><span class="n">new</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">it</span> <span class="s2">&quot;returns 0 for empty string&quot;</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">calc</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="mi">0</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">it</span> <span class="s2">&quot;returns 1 for &#39;1&#39;&quot;</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">calc</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="mi">1</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">it</span> <span class="s2">&quot;returns 3 for &#39;1,2&#39;&quot;</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">calc</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;1,2&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="mi">3</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">it</span> <span class="s2">&quot;returns 55 for &#39;1,2,3,4,5,6,7,8,9,10&#39;&quot;</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">calc</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;1,2,3,4,5,6,7,8,9,10&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="mi">55</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">it</span> <span class="s2">&quot;returns 6 for &#39;1</span><span class="se">\\</span><span class="s2">n2,3&#39;&quot;</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">calc</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;1</span><span class="se">\n</span><span class="s2">2,3&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="mi">6</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">it</span> <span class="s2">&quot;returns nil for &#39;1,</span><span class="se">\\</span><span class="s2">n&#39;&quot;</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">calc</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;1,</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">should</span> <span class="n">be_nil</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">context</span> <span class="s2">&quot;when changing the delimiter to &#39;;&#39;&quot;</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">it</span> <span class="s2">&quot;returns 3 for &#39;//;</span><span class="se">\\</span><span class="s2">n1;2&quot;</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">calc</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;//;</span><span class="se">\n</span><span class="s2">1;2&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="mi">3</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">context</span> <span class="s2">&quot;when changing the delimiter to &#39;: and terminating the string with &#39;</span><span class="se">\\</span><span class="s2">n&#39;&quot;</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">it</span> <span class="s2">&quot;returns nil for &#39;//:</span><span class="se">\\</span><span class="s2">n1:</span><span class="se">\\</span><span class="s2">n&quot;</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">calc</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;//:</span><span class="se">\n</span><span class="s2">1:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">should</span> <span class="n">be_nil</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Lispifying The Solution</h3>

<p>Since I wasn&#8217;t able to use the <code>if</code>, <code>else</code>, <code>switch</code>, and <code>case</code> keywords, I had to think of a new way of having my program make decisions. I observed that I was using methods that returned booleans such as <code>empty?</code>, <code>start_with?</code>, <code>end_with?</code>, and <code>include?</code>. My mind was screaming at me: &#8220;USE AN IF STATEMENT HERE!&#8221; I refrained. All I knew was that I wanted my program to make decisions based on whether or not the results of those method calls were true. Then I had my &#8216;Ah ha!&#8217; moment. Part of what led me to use the <code>&amp;&amp;</code> operator in my code came about because I am learning Common Lisp. Here is a snippet of Lisp code that checks to see if an atom belongs to a list:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="p">(</span><span class="n">defun</span> <span class="n">member?</span> <span class="p">(</span><span class="n">a</span> <span class="n">lst</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="n">cond</span>
</span><span class='line'>    <span class="p">((</span><span class="n">null</span> <span class="n">lst</span><span class="p">)</span> <span class="kp">nil</span><span class="p">)</span>
</span><span class='line'>    <span class="p">(</span><span class="n">T</span> <span class="p">(</span><span class="ow">or</span>
</span><span class='line'>         <span class="p">(</span><span class="n">eq</span> <span class="n">a</span> <span class="p">(</span><span class="n">car</span> <span class="n">lst</span><span class="p">))</span>
</span><span class='line'>         <span class="p">(</span><span class="n">member?</span> <span class="n">a</span> <span class="p">(</span><span class="n">cdr</span> <span class="n">lst</span><span class="p">))))))</span>
</span></code></pre></td></tr></table></div></figure>


<p>Take a look at the OR statement. If the atom <code>a</code> is equal to the first item of the list in <code>lst</code>, then <code>member?</code> returns true and it exits the function; otherwise it will evaluate the statement <code>member?</code> and pass the atom <code>a</code> and the remaining items in the <code>lst</code> not including the first item. Did you see how you can use an a function call as a statement to be used with an <code>or</code> operator? In my solution, I went ahead and using this logic except I used the <code>&amp;&amp;</code> operator to accomplish this. Let&#8217;s walk through some of the code in the solution.</p>

<h3>A Walkthrough</h3>

<p>We begin by recalling the requirements of the string calculator. The first requirement is to return 0 for an empty string. To meet that requirement, I write code to query the string and ask if it is <code>empty?</code>. When I pass an empty string, the response will be <code>true</code>. Since the statement to the left of the <code>&amp;&amp;</code> operator is true, the <code>&amp;&amp;</code> must take the next step of evaluating the statement to the right.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'> <span class="n">string</span><span class="o">.</span><span class="n">empty?</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="k">return</span> <span class="mi">0</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>The statement on the right is a <code>return</code> statement, so we leave the <code>add</code> function with the result of <code>0</code> for an empty string. The same logic applies to the next call <code>end_with?</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">string</span><span class="o">.</span><span class="n">end_with?</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="k">return</span> <span class="kp">nil</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>If the string ends with a newline character <code>"\n"</code>, the <code>&amp;&amp;</code> operator is forced to execute the statement to the right.</p>

<p>In the next few lines, I took the <code>&amp;&amp;</code> operator further. I know that all Ruby objects return <code>true</code>. With that understanding, I went ahead and chained three statements with the <code>&amp;&amp;</code> operator:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">string</span><span class="o">.</span><span class="n">start_with?</span><span class="p">(</span><span class="s2">&quot;//&quot;</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
</span><span class='line'>  <span class="p">(</span><span class="vi">@delimiter</span> <span class="o">||=</span> <span class="n">string</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">&#39;^//(.)&#39;</span><span class="p">)</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
</span><span class='line'>    <span class="n">string</span><span class="o">.</span><span class="n">sub!</span><span class="p">(</span><span class="sr">/^\/\/(.)/</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Doesn&#8217;t that cascading style remind you of Lisp? I think this is really cool! This code covers the case when the user wants to change the delimiter in the string. Instead of using commas and passing a string such as <code>"1,2"</code>, the user can now pass a string like this: <code>"//;\n1;2"</code>. Passing this kind of string to the <code>add</code> method should change the delimiter from a comma to a semicolon. Let&#8217;s suppose we receive the string <code>"//;\n1;2"</code>. We see it starts with <code>"//"</code> so the method <code>start_with?</code> returns <code>true</code>. Since we are <code>&amp;&amp;</code>ing our statements together, all of them must return true in order for all three to be executed, otherwise, we will skip to the next portion of the program. The next step involves capturing the new delimiter and caching the results to the <code>@delimiter</code> instance variable. That entire statement returns true because at the end <code>@delimiter</code> has a non-nil value. We move on to the next statement, which removes the delimiter information from the original string so that we can parse the number information.</p>

<p>This next line is my favorite one.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="vi">@delimiter</span> <span class="o">&amp;&amp;</span>
</span><span class='line'>  <span class="p">(</span><span class="k">return</span> <span class="n">string</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">#{</span><span class="vi">@delimiter</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:to_i</span><span class="p">)</span><span class="o">.</span><span class="n">inject</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:+</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<p>Since we received a cached result from the previous chain of statements for <code>@delimiter</code>, <code>@delimiter</code> is a non-nil object which evaluates to <code>true</code>. Since <code>@delimiter</code> evaluates to <code>true</code>, we move to the next statement and evaluate it. I especially like how I passed the methods <code>to_i</code> and <code>+</code> as symbols to the <code>map</code> and <code>inject</code> methods. It saved me space and communicates its intent! We split on the new delimiter, convert each string represented as a number to an integer, and then collect a running sum and return the result.</p>

<h2>Take Aways</h2>

<p>The most valuable thing I got from having done this kata were the constraints I placed on myself. They pushed me outside of the comfort of the familiar techniques I used and demanded more from me. I did notice the repetition toward the bottom of the <code>add</code> method. I had some difficulty refactoring the code in time. Perhaps next time I perform this kata, I&#8217;ll have a DRYer version.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Ruby Monk Problem - Capitalizing an Array With Names (Revisited)]]></title>
    <link href="http://danieldyba.com/blog/2011/11/15/ruby-monk-problem-capitalizing-an-array-with-names-revisited/"/>
    <updated>2011-11-15T18:27:00-08:00</updated>
    <id>http://danieldyba.com/blog/2011/11/15/ruby-monk-problem-capitalizing-an-array-with-names-revisited</id>
    <content type="html"><![CDATA[<h2>Another Look</h2>

<p>This is a follow up to my <a href="http://danieldyba.com/blog/2011/11/13/ruby-monk-problem-capitalizing-an-array-of-names/">previous blog post</a> on the Ruby Monk problem. The challenge with which I ended that post was to solve the problem with the constraint of using the <code>inject</code> method. Here&#8217;s a solution that meets that challenge:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="s2">&quot;emperor&quot;</span><span class="p">,</span> <span class="s2">&quot;john&quot;</span><span class="p">,</span> <span class="s2">&quot;abraham&quot;</span><span class="p">,</span> <span class="s2">&quot;norton&quot;</span><span class="o">].</span><span class="n">map</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:capitalize</span><span class="p">)</span><span class="o">.</span><span class="n">inject</span> <span class="k">do</span> <span class="o">|</span><span class="n">full_name</span><span class="p">,</span> <span class="nb">name</span><span class="o">|</span>
</span><span class='line'>  <span class="s2">&quot;</span><span class="si">#{</span><span class="n">full_name</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Instead of initializing the inject method with an empty string, I used the <code>map</code> method to apply the <code>capitalize</code> method on each of the elements in the array. Once I have done that, then using method chaining, I can start combining each element in the array in a cumulative manner with the <code>inject</code> method.</p>

<h2>Let&#8217;s Race</h2>

<p>Here&#8217;s an interesting question: If I had several thousands elements in the array, which solution would be better in terms of performance? It would probably be more efficient to use the hack in the previous post. In this solution, I am iterating through the array twice: once using the map method and a second time using the inject method.</p>

<p>I use Benchmark to give me an idea of what performance looks like between the two solutions.</p>

<figure class='code'><figcaption><span>Benchmarking the new solution</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;benchmark&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="n">names</span> <span class="o">=</span> <span class="o">[]</span>
</span><span class='line'>
</span><span class='line'><span class="mi">10000</span><span class="o">.</span><span class="n">times</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">names</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;emperor&quot;</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sr">//</span><span class="p">)</span><span class="o">.</span><span class="n">shuffle</span><span class="o">.</span><span class="n">join</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="no">Benchmark</span><span class="o">.</span><span class="n">bm</span> <span class="k">do</span> <span class="o">|</span><span class="n">trial</span><span class="o">|</span>
</span><span class='line'>  <span class="n">trial</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="s2">&quot;Map &amp; inject:             &quot;</span><span class="p">)</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">names</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:capitalize</span><span class="p">)</span><span class="o">.</span><span class="n">inject</span> <span class="k">do</span> <span class="o">|</span><span class="n">full_name</span><span class="p">,</span> <span class="nb">name</span><span class="o">|</span>
</span><span class='line'>      <span class="s2">&quot;</span><span class="si">#{</span><span class="n">full_name</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>  <span class="n">trial</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="s2">&quot;Inject with initial value:&quot;</span><span class="p">)</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">names</span><span class="o">.</span><span class="n">inject</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">full_name</span><span class="p">,</span> <span class="nb">name</span><span class="o">|</span>
</span><span class='line'>      <span class="s2">&quot;</span><span class="si">#{</span><span class="n">full_name</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="nb">name</span><span class="o">.</span><span class="n">capitalize</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">strip</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Double-take</h2>

<p>Take a look at these results:</p>

<figure class='code'><figcaption><span>Benchmark Results</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='console'><span class='line'><span class="go">                            user     system      total        real</span>
</span><span class='line'><span class="go">Map and inject:             0.310000   0.100000   0.410000 (  0.399476)</span>
</span><span class='line'><span class="go">Inject with initial value:  0.500000   0.190000   0.690000 (  0.691769)</span>
</span></code></pre></td></tr></table></div></figure>


<p>The new solution is <strong>40% faster</strong> than the solution in my previous post! This was not what I expected at all! It seems counter-intuitive that iterating through an array twice is faster than iterating through it once.</p>

<h2>Final Note</h2>

<p>Yup, I&#8217;m guilty of having relied too readily on my assumptions. This will serve as a reminder to keep asking questions that challenge my thinking. What may seem obvious may not be so.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Ruby Monk Problem - Capitalizing an Array of Names]]></title>
    <link href="http://danieldyba.com/blog/2011/11/13/ruby-monk-problem-capitalizing-an-array-of-names/"/>
    <updated>2011-11-13T12:09:00-08:00</updated>
    <id>http://danieldyba.com/blog/2011/11/13/ruby-monk-problem-capitalizing-an-array-of-names</id>
    <content type="html"><![CDATA[<h2>The Exercise</h2>

<p>In lesson 5 of <a href="http://rubymonk.com">RubyMonk.com</a>, there&#8217;s an exercise with the following objective:</p>

<blockquote><p>to capitalize the first character of each part of the name as it combined them.</p></blockquote>


<p>The code they provide is:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># bust out a beefy reduce on this bad boy:</span>
</span><span class='line'><span class="o">[</span><span class="s2">&quot;emperor&quot;</span><span class="p">,</span> <span class="s2">&quot;joshua&quot;</span><span class="p">,</span> <span class="s2">&quot;abraham&quot;</span><span class="p">,</span> <span class="s2">&quot;norton&quot;</span><span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>


<h3>First Attempt</h3>

<p>I worked out the code below but then realized it didn&#8217;t solve the problem.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="s2">&quot;emperor&quot;</span><span class="p">,</span> <span class="s2">&quot;joshua&quot;</span><span class="p">,</span> <span class="s2">&quot;abraham&quot;</span><span class="p">,</span> <span class="s2">&quot;norton&quot;</span><span class="o">].</span><span class="n">inject</span> <span class="k">do</span> <span class="o">|</span><span class="n">full_name</span><span class="p">,</span> <span class="nb">name</span><span class="o">|</span>
</span><span class='line'>  <span class="s2">&quot;</span><span class="si">#{</span><span class="n">full_name</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="nb">name</span><span class="o">.</span><span class="n">capitalize</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>This ends up with <code>"emperor Joshua Abraham Norton"</code>. I didn&#8217;t capitalize the first word <code>emperor</code>.</p>

<h3>Second Attempt</h3>

<p>Ok, no problem. I&#8217;ll just capitalize <code>full_name</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="s2">&quot;emperor&quot;</span><span class="p">,</span> <span class="s2">&quot;joshua&quot;</span><span class="p">,</span> <span class="s2">&quot;abraham&quot;</span><span class="p">,</span> <span class="s2">&quot;norton&quot;</span><span class="o">].</span><span class="n">inject</span> <span class="k">do</span> <span class="o">|</span><span class="n">full_name</span><span class="p">,</span> <span class="nb">name</span><span class="o">|</span>
</span><span class='line'>  <span class="s2">&quot;</span><span class="si">#{</span><span class="n">full_name</span><span class="o">.</span><span class="n">capitalize</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="nb">name</span><span class="o">.</span><span class="n">capitalize</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>No. You can&#8217;t do that. That will end up capitalizing just the first word <code>emperor</code>. You will end up with <code>"Emperor joshua abraham Norton"</code>. The reason is the block variable <code>full_name</code> remembers the last value calculated inside the block. Because we did not pass an initial value to the inject method, it uses the first value in your collection by default, in this case <code>"emperor"</code>. Inside the body of the block, we take <code>"emperor"</code> and capitalize it followed by <code>"joshua"</code> and capitalize that. We put the two together to get the complete string <code>"Emperor Joshua"</code>. You can try this out in irb by truncating your array to just two elements, <code>["emperor", "joshua"]</code>.</p>

<p>So far so good. Next, we use this result of the calculation carried out in the body of the block and pass it to the block variable <code>full_name</code>. The block variable <code>name</code> is set to the next item in our collection, which is <code>"abraham"</code>. We run through the body of the block again which leads us to capitalize <code>"Emperor Joshua"</code> and <code>"abraham"</code>. That gives us <code>"Emperor joshua"</code> and <code>"Abraham"</code>. That&#8217;s where things go wrong. When you <code>capitalize</code> a string, you are putting all characters except the first character in their lower case form.</p>

<h3>A Hack</h3>

<p>How then, do you capitalize the first name? By default, <code>inject</code> will use <code>"emperor"</code> as its initial value since I have passed no parameter to the <code>inject</code> method. What if I did try to pass in a parameter? What would that parameter be? What if I passed in an empty string? Ah, in that case, the <code>full_name</code> will be equal to <code>''</code>, the empty string.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="s2">&quot;emperor&quot;</span><span class="p">,</span> <span class="s2">&quot;joshua&quot;</span><span class="p">,</span> <span class="s2">&quot;abraham&quot;</span><span class="p">,</span> <span class="s2">&quot;norton&quot;</span><span class="o">].</span><span class="n">inject</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">full_name</span><span class="p">,</span> <span class="nb">name</span><span class="o">|</span>
</span><span class='line'>  <span class="s2">&quot;</span><span class="si">#{</span><span class="n">full_name</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="nb">name</span><span class="o">.</span><span class="n">capitalize</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">strip</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>If I only made a call to <code>"#{full_name} #{name.capitalize}"</code>, I would have an extra space in front of the name, <code>" Emperor Joshua Abraham Norton"</code>, by the time block iterated through all the items in the array. To get rid of this, I just <code>strip</code> the whitespace. Do you have another of solving this problem with the constraint of using the <code>inject</code> method? I&#8217;d love to hear your ideas.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Karate Chop Code Kata - Second Run]]></title>
    <link href="http://danieldyba.com/blog/2011/11/11/karate-chop-code-kata-second-run/"/>
    <updated>2011-11-11T12:41:00-08:00</updated>
    <id>http://danieldyba.com/blog/2011/11/11/karate-chop-code-kata-second-run</id>
    <content type="html"><![CDATA[<h2>Several Attempts With No Solution In Sight</h2>

<p>The second run at implementing the binary chop method was excruciating. After several attempts, I finally decided to check out what others were doing. Was I blinded to a particular kind of solution I had in mind? Was my understanding of recursion incorrect? I felt I probably had a blind spot that was keeping me from seeing the problem in a new way. After going out on a Google search for the solution, I came across <a href="http://softwareramblings.com/2009/11/codekata-kata-two-solution.html">Stephen Doyle&#8217;s Blog</a></p>

<p>Here is his solution:</p>

<figure class='code'><figcaption><span>Stephen Doyle&#8217;s Solution</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">chop</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
</span><span class='line'>  <span class="c1"># Special handling for zero and single element arrays</span>
</span><span class='line'>  <span class="k">return</span> <span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="n">values</span><span class="o">.</span><span class="n">empty?</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">return</span> <span class="p">((</span><span class="n">target</span> <span class="o">==</span> <span class="n">values</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">)</span> <span class="p">?</span> <span class="mi">0</span> <span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">values</span><span class="o">.</span><span class="n">length</span> <span class="o">==</span> <span class="mi">1</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># Try the bottom half first</span>
</span><span class='line'>  <span class="n">pos</span> <span class="o">=</span> <span class="nb">chop</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">values</span><span class="o">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">values</span><span class="o">.</span><span class="n">length</span><span class="o">/</span><span class="mi">2</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">pos</span> <span class="k">if</span> <span class="n">pos</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># Then the upper half ... remember that the returned</span>
</span><span class='line'>  <span class="c1"># position is relative to the middle of the array.</span>
</span><span class='line'>  <span class="n">pos</span> <span class="o">=</span> <span class="nb">chop</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">values</span><span class="o">[</span><span class="n">values</span><span class="o">.</span><span class="n">length</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">values</span><span class="o">.</span><span class="n">length</span><span class="o">-</span><span class="mi">1</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">pos</span> <span class="o">+</span> <span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">length</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">pos</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># Didn&#39;t find what we were looking for</span>
</span><span class='line'>  <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Since I didn&#8217;t solve this, I&#8217;m going to talk about some of the approaches I took while trying to solve this problem and why they failed.</p>

<h2>My Failed Ideas</h2>

<h3>The Tweaking Approach</h3>

<p>I solved the problem once. What if I reused the same ideas but changed things just a bit? Here is what I came up with.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">defchop</span><span class="p">(</span><span class="n">int</span><span class="p">,</span><span class="n">array_of_int</span><span class="p">)</span>
</span><span class='line'>  <span class="k">return</span> <span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="n">array_of_int</span><span class="o">.</span><span class="n">empty?</span>
</span><span class='line'>
</span><span class='line'>  <span class="vi">@max</span> <span class="o">||=</span> <span class="n">array_of_int</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="mi">1</span>
</span><span class='line'>  <span class="vi">@min</span> <span class="o">||=</span> <span class="mi">0</span>
</span><span class='line'>  <span class="vi">@mid</span> <span class="o">||=</span> <span class="vi">@max</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="vi">@min</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">return</span> <span class="vi">@mid</span> <span class="k">if</span> <span class="n">int</span> <span class="o">==</span> <span class="n">array_of_int</span><span class="o">[</span><span class="vi">@mid</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">return</span> <span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="vi">@mid</span> <span class="o">==</span> <span class="vi">@max</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span> <span class="n">int</span> <span class="o">&lt;</span> <span class="n">array_of_int</span><span class="o">[</span><span class="vi">@mid</span><span class="o">]</span>
</span><span class='line'>    <span class="vi">@max</span> <span class="o">=</span> <span class="vi">@mid</span>
</span><span class='line'>  <span class="k">else</span>
</span><span class='line'>    <span class="vi">@min</span> <span class="o">=</span> <span class="vi">@mid</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="nb">chop</span><span class="p">(</span><span class="n">int</span><span class="p">,</span><span class="n">array_of_int</span><span class="p">)</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>As you can see, it uses the same idea of markers to indicate which portion of the array I am focusing on. The problem was I used instance variables to maintain state in subsequent calls to the chop method. This was a bad idea because it gave me bogus results in between assertions in my test suite. So I had to do away with instance variables as a way to maintain state.</p>

<h3>The If-Else Construct Approach</h3>

<p>You can see that from the above attempt, I continued using the if-else construct to determine which path to take in order to find the index of the integer. I used this for EVERY solution thereafter. That If-Else construct stuck to me like a leech. I didn&#8217;t even think of the possibility of doing away with it because I thought that was the only way you could traverse a binary tree. One approach I didn&#8217;t consider was simply picking one half of the array and carrying out the search until you find nothing; only then would you search for the other half. I kept thinking I MUST know whether it is greater or smaller than the integer found at the midpoint of the array. Later in this post, I discuss why I got stuck to the if-else construct approach.</p>

<h2>My Successful Ideas</h2>

<p>Even as I was making several attempts at the solution, there was one approach I took that led me closer to the solution.</p>

<h3>Passing Smaller Array Slices Approach</h3>

<p>What I did figure out was that I needed to call the chop method and pass it a smaller slice of the array. If the integer was less than the integer I found at the midpoint, I would call the chop method like so:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">chop</span> <span class="p">(</span><span class="n">int</span><span class="p">,</span> <span class="n">array</span><span class="o">[</span><span class="mi">0</span><span class="o">.</span><span class="n">.mid</span><span class="o">-</span><span class="mi">1</span><span class="o">]</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>If the integer was greater than the integer I found at the midpoint, I would call the chop method like so:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">chop</span><span class="p">(</span><span class="n">int</span><span class="p">,</span> <span class="n">array</span><span class="o">[</span><span class="n">mid</span> <span class="o">+</span> <span class="mi">1</span><span class="o">.</span><span class="n">.</span><span class="o">-</span><span class="mi">1</span><span class="o">]</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>This approach is one which Stephen Doyle used when solving the problem with recursion. I was on the right track.</p>

<h2>The Missing Links</h2>

<p>Stepping back and seeing Doyle&#8217;s recursive solution, I noticed there were a few things I didn&#8217;t understand which hampered my progress toward a solution.</p>

<h3>Just Pick a Slice!</h3>

<p>I didn&#8217;t even know this would have been allowed as part of the spec. Below is a quote from Dave Thomas&#8217; CodeKata website:</p>

<blockquote><p>A binary chop (sometimes called the more prosaic binary search) finds the position of value in a sorted array of values. It achieves some efficiency by halving the number of items under consideration each time it probes the values: in the first pass it determines whether the required value is in the top or the bottom half of the list of values. In the second pass in considers only this half, again dividing it in to two. It stops when it finds the value it is looking for, or when it runs out of array to search.</p></blockquote>


<p>What I zeroed in on was this:</p>

<blockquote><p>&#8230;in the first pass it determines whether the required value is in the top of bottom half of the list of values</p></blockquote>


<p>I thought that the implementation involved the decision-making logic of an if-else construct where you would check if the required value is in the top half or bottom half of the list of values. That was my train of thought. But nowhere in that sentence does it say you have to use an if-else construct. To me, the sentence is misleading. Perhaps I read too much into it which ultimately led to my brain focusing on solutions that only used if-else constructs.</p>

<p>Stephen&#8217;s solution involves picking the bottom slice first. If the integer is not in the bottom slice, then the logic will go on to check the top slice until it finds the integer or returns a <code>-1</code> to indicate it found no matching integer.</p>

<h2>The Solution</h2>

<p>There are a few things I would change in Stephen&#8217;s solution to make things a little more concise. Here is my solution:</p>

<figure class='code'><figcaption><span>Karate Chop Code Kata - Second Run </span><a href='https://github.com/dyba/katas-samples/blob/master/karate_chop/karate_chop_2.rb'>See on Github</a></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">chop</span><span class="p">(</span><span class="n">int</span><span class="p">,</span> <span class="n">array_of_int</span><span class="p">)</span>
</span><span class='line'>  <span class="k">return</span> <span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="n">array_of_int</span><span class="o">.</span><span class="n">empty?</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">mid</span> <span class="o">=</span> <span class="n">array_of_int</span><span class="o">.</span><span class="n">size</span> <span class="o">/</span> <span class="mi">2</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">return</span> <span class="p">((</span><span class="n">int</span> <span class="o">==</span> <span class="n">array_of_int</span><span class="o">[</span><span class="n">mid</span><span class="o">]</span><span class="p">)</span> <span class="p">?</span> <span class="n">mid</span> <span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">array_of_int</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">pos</span> <span class="o">=</span> <span class="nb">chop</span><span class="p">(</span><span class="n">int</span><span class="p">,</span> <span class="n">array_of_int</span><span class="o">[</span><span class="mi">0</span><span class="o">.</span><span class="n">.</span><span class="o">.</span><span class="n">mid</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">pos</span> <span class="k">if</span> <span class="n">pos</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">pos</span> <span class="o">=</span> <span class="nb">chop</span><span class="p">(</span><span class="n">int</span><span class="p">,</span> <span class="n">array_of_int</span><span class="o">[</span><span class="n">mid</span><span class="o">.</span><span class="n">.</span><span class="o">-</span><span class="mi">1</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">pos</span> <span class="o">+</span> <span class="n">mid</span> <span class="k">if</span> <span class="n">pos</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Stephen&#8217;s solution starts by checking the 0 index of the array. I went ahead and started in the middle. Also, by defining the midpoint with the <code>mid</code> variable, I can condense the portion of the array I pass to the chop method. I also went ahead and used ranges instead of the comma syntax inside the brackets. Rather than use <code>array_of_int[array_of_int / 2, array_of_int.size - 1]</code>, I preferred the use of ranges and negative indexing to shorten the parameter I pass.</p>

<h2>A Final Note</h2>

<p>Dave Thomas hints at a third solution:</p>

<blockquote><p>&#8230;one might use a functional style passing array slices around&#8230;</p></blockquote>


<p>Let&#8217;s see how well I fare solving it in that style.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Karate Chop Code Kata - First Run]]></title>
    <link href="http://danieldyba.com/blog/2011/11/07/karate-chop-code-kata-first-run/"/>
    <updated>2011-11-07T18:40:00-08:00</updated>
    <id>http://danieldyba.com/blog/2011/11/07/karate-chop-code-kata-first-run</id>
    <content type="html"><![CDATA[<h2>The Idea</h2>

<p>Here is my first attempt at Code Kata #2 - Karate Chop, which is an exercise you can find on Dave Thomas&#8217; website <a href="http://codekata.pragprog.com/2007/01/kata_two_karate.html">Code Kata</a>. Now mind you, I never had a formal introduction to computer algorithms. I had to look at a computer algorithms book to make sure I understood what was meant by the term binary search routine. The idea behind Karate Chop is to write a binary search routine that takes an integer and an array, splits the array in two, determines which half of the array the integer should be on and repeats the process until it finds the integer and returns it or doesn&#8217;t find it and returns a <code>-1</code>. In the end I should have a function that can be described as follows:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">chop</span><span class="p">(</span><span class="n">integer</span><span class="p">,</span> <span class="n">array_of_integers</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">integer</span>
</span></code></pre></td></tr></table></div></figure>


<p>The integer it returns should be the index of the array in which I found the matching number. In the event that I do not find the integer in the array, I should get a <code>-1</code>.</p>

<h2>The Solution</h2>

<figure class='code'><figcaption><span>Karate Chop Code Kata - First Run </span><a href='https://github.com/dyba/katas-samples/blob/master/karate_chop/karate_chop.rb'>See On Github</a></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">chop</span><span class="p">(</span><span class="n">int</span><span class="p">,</span><span class="n">array_of_int</span><span class="p">)</span>
</span><span class='line'>  <span class="k">return</span> <span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="n">array_of_int</span><span class="o">.</span><span class="n">empty?</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">min</span><span class="p">,</span> <span class="n">max</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">array_of_int</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="mi">1</span>
</span><span class='line'>  <span class="n">midpoint</span> <span class="o">=</span> <span class="n">max</span> <span class="o">/</span> <span class="mi">2</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">while</span> <span class="n">int</span> <span class="o">!=</span> <span class="n">array_of_int</span><span class="o">[</span><span class="n">midpoint</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span> <span class="n">int</span> <span class="o">&lt;</span> <span class="n">array_of_int</span><span class="o">[</span><span class="n">midpoint</span><span class="o">]</span>
</span><span class='line'>      <span class="n">max</span> <span class="o">=</span> <span class="n">midpoint</span> <span class="o">-</span> <span class="mi">1</span>
</span><span class='line'>    <span class="k">else</span>
</span><span class='line'>      <span class="n">min</span> <span class="o">=</span> <span class="n">midpoint</span> <span class="o">+</span> <span class="mi">1</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    <span class="n">midpoint</span> <span class="o">=</span> <span class="n">min</span> <span class="o">+</span> <span class="p">(</span><span class="n">max</span> <span class="o">-</span> <span class="n">min</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
</span><span class='line'>    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="n">max</span> <span class="o">&lt;</span> <span class="n">min</span> <span class="o">||</span> <span class="n">min</span> <span class="o">&gt;</span> <span class="n">midpoint</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">midpoint</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h2>The Walkthrough</h2>

<h3>Edge Cases</h3>

<p>I implement the binary search routine using a while loop. I address the the edge case when the array is empty. When that hapens, I know that I must return <code>-1</code> because no integer will ever be present in an empty array.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">return</span> <span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="n">array_of_int</span><span class="o">.</span><span class="n">empty?</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Markers Point You In the Right Direction</h3>

<p>In this solution, I use markers to let me know what portion of the array I am focusing on. I start off by initializing my markers. I have a min marker which tells me the first element of the array, and I have a max marker which tells me the last element of the array. The midpoint marker tells me which index is the midpoint of the array. These markers will change during the course of the program as I search through smaller subsections of the array.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="n">min</span><span class="p">,</span> <span class="n">max</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">array_of_int</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="mi">1</span>
</span><span class='line'>  <span class="n">midpoint</span> <span class="o">=</span> <span class="n">max</span> <span class="o">/</span> <span class="mi">2</span>
</span></code></pre></td></tr></table></div></figure>


<h3>The Search Is On</h3>

<p>Now comes the interesting part, the loop construct. I decided to use the while loop to iterate through the array because it was the first solution that came to mind. Only if I found the matching integer would I exit the while loop and return the index of the array in which I found the matching number.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">while</span> <span class="n">int</span> <span class="o">!=</span> <span class="n">array_of_int</span><span class="o">[</span><span class="n">midpoint</span><span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>Inside the while loop, I check for the condition where the integer I seek is less than the integer I find at the midpoint of the array. If it is less, then I move my max marker to 1 less than the midpoint; if more, then I move my min marker to 1 more than the midpoint. This is easily illustrated with a diagram.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">if</span> <span class="n">int</span> <span class="o">&lt;</span> <span class="n">array_of_int</span><span class="o">[</span><span class="n">midpoint</span><span class="o">]</span>
</span><span class='line'>  <span class="n">max</span> <span class="o">=</span> <span class="n">midpoint</span> <span class="o">-</span> <span class="mi">1</span>
</span><span class='line'><span class="k">else</span>
</span><span class='line'>  <span class="n">min</span> <span class="o">=</span> <span class="n">midpoint</span> <span class="o">+</span> <span class="mi">1</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Notice that with each iteration, I am focusing on a smaller portion of the array. After the if-else construct, I advance the midpoint marker to reflect the new midpoint for the smaller portion of the array that I am focusing on.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">midpoint</span> <span class="o">=</span> <span class="n">min</span> <span class="o">+</span> <span class="p">(</span><span class="n">max</span> <span class="o">-</span> <span class="n">min</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
</span></code></pre></td></tr></table></div></figure>


<h3>When Markers Go Wrong</h3>

<p>Here is where it gets tricky. A strange thing happens when the integer is not present in the array: the max, min, and midpoint markers go berserk! They no longer begin to make sense. That&#8217;s when I know it&#8217;s time to jump out of the loop and return a <code>-1</code> to indicate that there was no matching integer inside the array.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">return</span> <span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="n">max</span> <span class="o">&lt;</span> <span class="n">min</span> <span class="o">||</span> <span class="n">min</span> <span class="o">&gt;</span> <span class="n">midpoint</span>
</span></code></pre></td></tr></table></div></figure>


<p>Finally, the last line returns the index of the array that matched the integer I passed to the function.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="n">midpoint</span>
</span></code></pre></td></tr></table></div></figure>


<h2>A Final Note</h2>

<p>Don&#8217;t let my explanation fool you, this was a difficult exercise for me. At first I was thinking about chopping the array in half and then searching through each half iterating through each element one by one to see if I found the integer. That wasn&#8217;t the correct way to go about it; it would have been an incorrect implementation of a binary search. When you come across unfamiliar terms, you must start by understanding those terms before you can tackle a problem. My problem was that I didn&#8217;t understand the idea of a binary search.</p>

<p>This exercise took me somewhere close to 8 hours. I&#8217;m hoping to cut my time in half in the next implementation. Stick around as I try to solve this again using a different implementation.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Using 'Bundle Install' in a Rails 3 Generator]]></title>
    <link href="http://danieldyba.com/blog/2011/10/16/using-bundle-install-in-a-rails-3-generator/"/>
    <updated>2011-10-16T00:04:00-07:00</updated>
    <id>http://danieldyba.com/blog/2011/10/16/using-bundle-install-in-a-rails-3-generator</id>
    <content type="html"><![CDATA[<h3>Problem</h3>

<p>I came across Rails issue <a href="https://github.com/rails/rails/issues/3153">#3153</a> on Github which involved someone thinking <code>bundle install</code> didn&#8217;t work with Rails generators.</p>

<p>When working with Rails generators it&#8217;s important to remember that generators use Yehuda Katz&#8217;s Thor gem. The issue arose because the user tried to run the command <code>bundle install</code> from inside the directory in which the generator file had been created.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">SomegenGenerator</span> <span class="o">&lt;</span> <span class="no">Rails</span><span class="o">::</span><span class="no">Generators</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'> <span class="n">source_root</span> <span class="no">File</span><span class="o">.</span><span class="n">expand_path</span><span class="p">(</span><span class="s1">&#39;../templates&#39;</span><span class="p">,</span> <span class="bp">__FILE__</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'> <span class="k">def</span> <span class="nf">install</span>
</span><span class='line'>   <span class="n">gem</span> <span class="s2">&quot;unicorn&quot;</span>
</span><span class='line'>   <span class="n">run</span> <span class="s2">&quot;bundle install&quot;</span>
</span><span class='line'> <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Solution</h3>

<p>Again, the issue is that the command <code>bundle install</code> is being run from inside the directory <code>Issue3153/lib/generators/something/</code>. I&#8217;ll let you take a quick look at the Thor source code at <a href="https://github.com/wycats/thor/blob/master/lib/thor/actions.rb#L161">lib/thor/actions.rb</a>. As you have now seen, we can use the <code>inside</code> method to run the <code>bundle install</code> command from the root directory of our app Issue3153.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># Issue3153/lib/generators/something/something_generator.rb</span>
</span><span class='line'><span class="k">class</span> <span class="nc">SomethingGenerator</span> <span class="o">&lt;</span> <span class="no">Rails</span><span class="o">::</span><span class="no">Generators</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>  <span class="n">source_root</span> <span class="no">File</span><span class="o">.</span><span class="n">expand_path</span><span class="p">(</span><span class="s1">&#39;../templates&#39;</span><span class="p">,</span> <span class="bp">__FILE__</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">install</span>
</span><span class='line'>    <span class="n">gem</span> <span class="s2">&quot;unicorn&quot;</span>
</span><span class='line'>    <span class="n">inside</span> <span class="no">Rails</span><span class="o">.</span><span class="n">root</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">run</span> <span class="s2">&quot;bundle install&quot;</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>This now works!</p>

<h3>Take Aways</h3>

<ul>
<li>Rails generators use Thor Actions</li>
<li>The bundle install command must be run in the directory where the Gemfile of interest resides</li>
</ul>

]]></content>
  </entry>
  
</feed>
